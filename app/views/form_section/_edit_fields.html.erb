<div class="row">
  <% if @form_section.editable? %>
    <div class="large-4 medium-4 columns">
      <h4><%= t("fields.label") %></h4>
    </div>
    <div class="large-4 medium-4 columns">
    </div>
    <div class="large-4 medium-4 columns">
        <a href="#" data-reveal-id="add_field_modal" class="btn green-button"><%=t("fields.add")%></a>
    </div>
  <% else %>
    <div class="large-12 medium-12 columns">
      <h3><i><%= t("forms.cannot_be_edited") %></i></h3>
    </div>
  <% end %> 
</div>

<div class="row">
  <div class="large-12 medium-12 columns">
    <div class="text_info"><%= t("form_section.messages.drag_drop_help_text").html_safe %></div>
  </div>
</div>

<div class="row">
  <div class="large-12 medium-12 columns">
    <input type="hidden" id="toggle_url" value="<%= toggle_fields_form_section_fields_path(@form_section) %>">
    <input type="hidden" id="edit_url" value="<%= edit_form_section_path(@form_section) %>">
    <input type="hidden" id="move_url" value="<%= change_form_form_section_fields_path(@form_section) %>">
    <input type="hidden" id="save_order_url" value="<%= save_order_form_section_fields_path(@form_section) %>">

    <table id="list_table_2" class="list_table_2">
      <thead>
        <tr>
          <th><%= t("name") %></th>
          <th><%= t("form_section.db_name") %></th>
          <th><%= t("help_text") %></th>
          <th><%= t("form_section.options") %></th>
          <th><%= t("fields.type") %></th>
          <th align="center"><%= t("form_section.hide") %></th>
          <th align="center"><%= t("form_sectoin.actions") %></th>
        </tr>
      </thead>
      <tbody>
        <% @form_section.fields.each do |field| %>
          <% unless field.new? %>
            <tr data="<%= field.name %>" class="<%= field.visible? ? "rowEnabled" : "rowDisabled" %>">
              <td>
                <% if field.type == 'subform' %>
                  <%= link_to field.display_name, edit_form_section_path(field.subform_section_id, module_id: @primero_module) %>
                <% else %>
                  <%= field.display_name %>
                <% end %>
              </td>
              <td><%= field.name %></td>
              <td><%= field.help_text %></td>
              <td>
                <%= field_value_for_display(field.options_list(@lookups)) %>
              </td>
              <td><%= field.type.try(:humanize) %></td>
              <td align="center">
                <% if @form_section.editable? && field.editable? %>
                  <%= check_box_tag "fields[]", field.name, !field.visible? , {:id => "fields_#{field.name}", :class => "field_hide_show"} %>
                <% end %>
              </td>
              <td class='field-buttons'>
                <% if @form_section.editable? && field.editable? %>
                  <%= link_to t("buttons.edit"),
                              edit_form_section_field_path(form_section_id: @form_section.unique_id, id: field.name, module_id: @module_id),
                              :id => "#{field.name}_edit"
                  %>
                  <%= render :partial => "form_section/delete_button", :locals => {:field => field, :url => delete_form_section_fields_path(@form_section.unique_id),
                                                                         :warning => I18n.t("messages.warning")} %> <%= hidden_field_tag "field_name" "#{field.name}" %>
                  <a href="javascript:void(0)" class="link_moveto"><%= t("fields.move_to") %></a>
                  <% if @forms_for_move.present? %>
                  <div class="move_to_panel hide">
                      <%= form_tag change_form_form_section_fields_path(@form_section), :html => {:method => :post} do -%>
                        <input type='hidden' name='id' value='<%= field.name %>' style="display:none;"/>
                        <input type='hidden' class="destination_form_id" name='destination_form_id' style="display:none;"/>
                      <% end %>
                      <%= select_tag "#{field.name}_destination_form_id", options_for_select(@forms_for_move, @form_section.unique_id), :class => "field_location"%>
                    </div>
                     <% end %>
                <% end %>
              </td>
            </tr>
          <% end %>
        <% end %>
      </tbody>
    </table>
  </div>
</div>

<div id="add_field_modal" class="reveal-modal" data-reveal>
  <a class="close-reveal-modal">&#215;</a>
  <ul class="field_types clearfix">
    <% if @field.present? && @field.type.present? %>
      <li><%= link_to t("fields.#{@field.type}"), "javascript:void(0)", :id => "#{@field.type}", :class => "field_links sel" %> </li>
    <% else %>
      <li><%= link_to t("fields.text_field"), "javascript:void(0)", :id => "text_field", :class => "field_links sel" %> </li>
      <li><%= link_to t("fields.text_area"), "javascript:void(0)", :id => "textarea", :class => "field_links" %></li>
      <li><%= link_to t("fields.check_box"), "javascript:void(0)", :id => "check_boxes", :class => "field_links" %></li>
      <li><%= link_to t("fields.tick_box"), "javascript:void(0)", :id => "tick_box", :class => "field_links" %></li>
      <li><%= link_to t("fields.select_box"), "javascript:void(0)", :id => "select_box", :class => "field_links" %></li>
      <li><%= link_to t("fields.radio_button"), "javascript:void(0)", :id => "radio_button", :class => "field_links" %></li>
      <li><%= link_to t("fields.numeric_field"), "javascript:void(0)", :id => "numeric_field", :class => "field_links" %></li>
      <li><%= link_to t("fields.tally_field"), "javascript:void(0)", :id => "tally_field", :class => "field_links" %></li>
      <li><%= link_to t("fields.date_field"), "javascript:void(0)", :id => "date_field", :class => "field_links" %></li>
      <li><%= link_to t("fields.date_range_field"), "javascript:void(0)", :id => "date_range", :class => "field_links" %></li>
      <li><%= link_to t("fields.separator"), "javascript:void(0)", :id => "separator", :class => "field_links" %></li>
      <% unless @form_section.is_nested %>
        <li><%= link_to t("fields.subform"), "javascript:void(0)", :id => "subform", :class => "field_links" %></li>
      <% end %>
    <% end %>
  </ul>

  <% @field ||= Field.new(:type => 'text_field') %>
  <%= error_messages_for  :field,
                          :header_tag => :h3,
                          :header_message => t("form_section.messages.cannot_create"),
                          :message => t('form_section.messages.correct_errors') %>
  <%= render :partial => 'form_section/add_field', :locals => {:div_id => "field_details", :fields => [{:display_name => :text_field}, {:help_text => :text_area}] } %>
  <%= render :partial => 'form_section/add_field', :locals => {:div_id => "field_details_options", :fields => [{:display_name => :text_field}, {:help_text => :text_area},
                                                                                                               {:option_strings_text => :text_area}] } %>
  <%= render :partial => 'form_section/add_field', :locals => {:div_id => "field_details_select_box", :fields => [{:display_name => :text_field}, {:help_text => :text_area},
                                                                                                                  {:option_strings_text => :text_area}, {:option_strings_source => :select_box}] } %>
  <%= render :partial => 'form_section/add_field', :locals => {:div_id => "field_details_tally", :fields => [{:display_name => :text_field}, {:help_text => :text_area}, {:tally => :tally_field}] } %> 
  <%
    #TODO
    # handle hidden text fields
  %>
</div>