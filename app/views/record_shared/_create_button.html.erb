<% if can? :create, model %>
  <% button_label = t("#{record.pluralize}.register_new_#{record}") %>
  <% if !defined?(modules) || !modules.present? %>
    <%= link_to content_tag(:span, button_label, class: 'create_user'), new_polymorphic_path(record),  class: 'button hollow right' %>
  <% elsif modules.size > 1 %>
    <ul id="menu" class="dropdown menu" data-dropdown-menu>
      <li>
        <a data-toggle="modules-dropdown" data-close-on-click="true" class="button hollow"><%= content_tag(:span, button_label) %></a>
        <ul class="menu">
        <% modules.each do |primero_module| %>
            <%# TODO: translate the module name %>
            <li>
              <%= content_tag( :a, primero_module.name, :class => 'dropdown_link', :'href' => new_polymorphic_path(record, module_id: primero_module.id)) %>
            </li>
        <% end %>
        </ul>
      </li>
    </ul>
  <% elsif modules.size == 1 %>
    <%= link_to content_tag(:span, button_label, class: 'create_user'), new_polymorphic_path(record, {module_id: modules.first.id}),  class: 'button hollow right' %>
  <% end %>
<% end %>