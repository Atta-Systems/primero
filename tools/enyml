#!/usr/bin/python3


import os
import shlex
import sys

import yaml


PROJECT_ROOT = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))
PROGRAM_NAME = os.path.basename(__file__)

YAML_FILE = os.path.join(PROJECT_ROOT, "config/locales/en.yml")


assert os.path.isfile(YAML_FILE)
assert os.access(YAML_FILE, os.R_OK)


def main():
    validate_yaml_structure()
    validate_yaml_keys()


def validate_yaml_structure():
    yamllint_cmd = (
        'yamllint -d "{extends: default, rules: {line-length: disable}}" '
        + shlex.quote(YAML_FILE)
    )

    if os.system(yamllint_cmd) != 0:
        sys.exit(1)


def validate_yaml_keys():
    fp = open(YAML_FILE, "r")

    yaml_dict = yaml.load(fp)
    validate_yaml_dict_keys(yaml_dict)

    fp.close()


def validate_yaml_dict_keys(yaml_dict):

    for key, value in yaml_dict.items():
        assert isinstance(key, str), "{} is not a string".format(str(key))

        if isinstance(value, dict):
            validate_yaml_dict_keys(value)


if __name__ == "__main__":
    main()
